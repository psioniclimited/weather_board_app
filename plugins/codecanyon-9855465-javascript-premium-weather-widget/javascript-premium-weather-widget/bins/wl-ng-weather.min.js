(function(){"use strict";var e=angular.module("wl-ng-weather",["ngAnimate"]);e.directive("skycon",[function(){return{replace:true,restrict:"A",scope:{size:"=",icon:"="},link:function(e,t,n){var r=n.color;if(!r){r="#fff"}var i=new Skycons({color:r});var s=document.createElement("canvas");e.$watch("size",function(t){if(t){s.width=s.height=e.size||64}},true);i.add(s,e.icon);e.$watch("icon",function(t){if(t){i.set(s,e.icon)}},true);e.$on("$destroy",function(){i.remove(s);if(i.list.length===0){i.pause(s)}});if(t[0].nodeType===8){t.replaceWith(s)}else{t[0].appendChild(s)}i.play()}}}]);e.filter("wlNgWTimeConverter",[function(){return function(e,t){var n=function(e,t){return e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()};var r=function(e){switch(e){case 0:return"Sunday";break;case 1:return"Monday";break;case 2:return"Tuesday";break;case 3:return"Wednesday";break;case 4:return"Thursday";break;case 5:return"Friday";break;case 6:return"Saturday";break;default:return"Someday";break}};var i=new Date(0);i.setUTCSeconds(e);if(t=="day-night"){var s=i.getHours();if(s>=5&&s<=20){return"day"}return"night"}var o=new Date;var u=new Date;u.setDate(o.getDate()+1);var a="";if(n(o,i)){a="Today"}else if(n(u,i)){a="Tomorrow"}else{a=r(i.getDay())}if(t=="short-day"){return a.substring(0,3)}else if(t=="long-day"){return a}return i.toLocaleDateString()}}]);e.filter("wlNgWTrim3",[function(){return function(e){return e.substring(0,3)}}]);e.filter("wlNgWTemp",[function(){return function(e,t){if(!e){return 0}var n=e;if(t=="C"){n=(e-32)*5/9}return n.toFixed(0)}}]);e.filter("wlNgWSpeed",[function(){return function(e,t){if(!e){return 0}var n=e;if(t=="C"){n=e/.62137}return n.toFixed(2)}}]);e.filter("wlNgWPressure",[function(){return function(e,t){if(!e){return 0}var n=e;if(t=="F"){n=29.92*e/1013.25}return n.toFixed(2)}}]);e.value("wlNgWLocaleDictionary",{});e.filter("wlNgWLocale",["wlNgWLocaleDictionary",function(e){return function(t,n){if(n=="en"){return t}if(!e[n]){return t}if(!e[n][t]){return t}return e[n][t]}}]);e.filter("wlNgRainbow",[function(){return function(e){var t=["rgba(0, 128, 9, 0.6)","rgba(255, 161, 4, 0.6)","rgba(128, 58, 127, 0.6)","rgba(202, 81, 12, 0.6)","rgba(31, 122, 202, 0.6)","rgba(234, 230, 0, 0.6)"];return t[e]}}]);e.service("wlNgWGeoLocationBrowser",["$q",function(e){return{get:function(){var t=e.defer();var n=false;if(navigator.geolocation){var r=setTimeout(function(){clearTimeout(r);if(!n){n=true;t.reject("Browser geolocation timeout")}},5e3);navigator.geolocation.getCurrentPosition(function(e){clearTimeout(r);n=true;t.resolve({latitude:e.coords.latitude,longitude:e.coords.longitude})},function(e){clearTimeout(r);n=true;t.reject(e)})}else{t.reject("Geolocation is not supported by this browser.")}return t.promise}}}]);e.service("wlNgWGeoLocationTelize",["$q","$http",function(e,t){return{get:function(){var n=e.defer();t.jsonp("http://www.telize.com/geoip?callback=JSON_CALLBACK").then(function(e){n.resolve({latitude:e.data.latitude,longitude:e.data.longitude})},function(e){n.reject(e)});return n.promise}}}]);e.service("wlNgWGeoPredictionGoogle",["$q",function(e){return{get:function(t){var n=new google.maps.places.AutocompleteService;var r=e.defer();n.getQueryPredictions({input:t},function(e,t){if(t!=google.maps.places.PlacesServiceStatus.OK){r.reject(t)}else{r.resolve(e)}});return r.promise}}}]);e.service("wlNgWGeoCodingGoogle",["$q",function(e){return{get:function(t){var n=new google.maps.Geocoder;var r=e.defer();n.geocode({address:t},function(e,t){if(t!=google.maps.places.PlacesServiceStatus.OK){r.reject(t)}else{r.resolve(e[0])}});return r.promise}}}]);e.service("wlNgWForecastIo",["$q","$http","$filter","bins","apikey",function(e,t,n,r,i){var s=function(e){var t={latitude:e.latitude,longitude:e.longitude,zone:e.timezone,current:{time:e.currently.time,dayNight:n("wlNgWTimeConverter")(e.currently.time,"day-night"),description:e.currently.summary,icon:e.currently.icon,temperature:e.currently.temperature,temperatureApparent:e.currently.apparentTemperature,humidity:(e.currently.humidity*100).toFixed(0),windSpeed:e.currently.windSpeed,pressure:e.currently.pressure,precipitationIntensity:e.currently.precipIntensity,precipitationProbability:e.currently.precipProbability},today:{},tomorrow:{},forecast:[]};for(var r=0;r<e.daily.data.length;r++){var i=e.daily.data[r];t.forecast.push({time:i.time,description:i.summary,icon:i.icon,temperatureMin:i.temperatureMin,temperatureMax:i.temperatureMax,humidity:(i.humidity*100).toFixed(0),windSpeed:i.windSpeed,pressure:i.pressure,precipitationProbability:i.precipProbability})}t.today=t.forecast[0];t.tomorrow=t.forecast[1];return t};return{get:function(n,r,o){var u=["bs","de","en","es","fr","it","nl","pl","pt","ru"];if(!o||-1===u.indexOf(o)){o="en"}var a=e.defer();t.jsonp("https://api.forecast.io/forecast/"+i+"/"+n+","+r+"?units=us&lang="+o+"&callback=JSON_CALLBACK").then(function(e){a.resolve(s(e.data))},function(e){a.reject(e)});return a.promise}}}]);e.directive("wlNgEditableLabel",["$timeout",function(e){return{replace:true,restrict:"A",template:'<div><input class="form-control" style="cursor:pointer;background:transparent;border:none;color:inherit;box-shadow:none;text-shadow:inherit;font-size:inherit;transition:none;-webkit-transition:none;-moz-transition:none;-o-transition:none;" readonly ng-click="showTyping()" ng-show="!isTyping" ng-model="value"/><input class="form-control" style="text-shadow:none;font-size:inherit;transition:none;-webkit-transition:none;-moz-transition:none;-o-transition:none;" ng-show="isTyping" ng-model="localValue" ng-keydown="onKeyDown($event)" ng-blur="hideTyping()"/></div>',scope:{value:"=",onChanged:"&",isTyping:"="},link:function(t,n){t.isTyping=false;t.$watch("value",function(){if(t.value){t.localValue=t.value}});t.$watch("isTyping",function(e){if(e){t.showTyping()}});t.showTyping=function(){t.isTyping=true;e(function(){n[0].children[1].select();n[0].children[1].focus()})};t.hideTyping=function(){t.isTyping=false};t.onKeyDown=function(n){if(n.keyCode==13){t.value=t.localValue;t.hideTyping();e(function(){t.onChanged()})}else if(n.keyCode==27){t.localValue=t.value;t.hideTyping()}}}}}]);e.directive("wlNgWeather",["$q","$interval","bins","wlNgWForecastIo","wlNgWGeoLocationBrowser","wlNgWGeoLocationTelize","wlNgWGeoPredictionGoogle","wlNgWGeoCodingGoogle","wlNgWLocaleDictionary",function(e,t,n,r,i,s,o,u,a){return{replace:true,restrict:"A",template:'<div class="wlww-animate" ng-show="weather!=null" ng-style="getBackgroundStyle()"><style>.wlww-animate{-webkit-transition:all linear 0.5s;transition:all linear 0.5s;} .wlww-animate.ng-hide{opacity:0;} .wlww-fixed{position:relative;height:100%;width:100%;}</style><div ng-style="getRefreshBackgroundStyle()"><div ng-include="getLocale()"></div><div ng-include="getTheme()"></div></div></div>',scope:{theme:"@",background:"@",latitude:"@",longitude:"@",location:"@",lang:"@",units:"@"},controller:["$scope",function(e){var t="North Pole";e.units=e.units||"si";var f={latitude:0,longitude:0,name:null};e.locale=a;e.weather=null;e.mu={temperature:"C",speed:"km/h",pressure:"mBar"};e.options={forecastDays:5,showForecast:false,isSearching:false,isRefreshing:false};e.bins=n;e.getTheme=function(){e.theme=e.theme||"complex1";return n+"/themes/"+e.theme+".html"};e.getLocale=function(){if(!e.lang||e.lang=="en"){return""}return n+"/lang/"+e.lang+".html"};e.getBackgroundStyle=function(){e.background=e.background||"dynamic";if(!e.weather||!e.weather.current||!e.weather.current.icon){return null}var t=e.weather.current.icon.replace("-day","").replace("-night","");return{"background-color":e.background!="dynamic"?e.background:"transparent","background-image":e.background=="dynamic"?"url('"+n+"/assets/bg-"+t+"-"+e.weather.current.dayNight+".jpg')":"none","background-repeat":"no-repeat","background-position":"center","background-size":"cover","text-shadow":e.background!="dynamic"?"none":"1px 1px 2px #000, 1px 1px 4px #000, 1px 1px 7px #000"}};e.getRefreshBackgroundStyle=function(){return{"background-color":e.options.isRefreshing?"rgba(0, 0, 0, 0.5)":"transparent","-webkit-transition":"all linear 0.5s",transition:"all linear 0.5s"}};var l=function(t,n,r){f.latitude=t;f.longitude=n;f.name=r;e.refresh()};var c=function(){i.get().then(function(e){l(e.latitude,e.longitude,null)},function(){s.get().then(function(e){l(e.latitude,e.longitude,null)},function(){l(90,0,t)})})};var h=function(e){o.get(e).then(function(e){var n=e[0];u.get(n.description).then(function(e){l(e.geometry.location.lat(),e.geometry.location.lng(),n.description)},function(){l(90,0,t)})},function(){l(90,0,t)})};e.refresh=function(){e.options.isRefreshing=true;var t=setTimeout(function(){r.get(f.latitude,f.longitude,e.lang).then(function(n){e.weather=n;if(f.name){e.weather.zone=f.name}e.options.isRefreshing=false;clearTimeout(t)},function(n){e.options.isRefreshing=false;clearTimeout(t);alert(n)})},200)};e.doSearch=function(){h(e.weather.zone)};e.startSearch=function(){e.options.isSearching=true};e.switchMu=function(){if(e.mu.temperature=="F"){e.mu.temperature="C";e.mu.speed="km/h";e.mu.pressure="mBar"}else{e.mu.temperature="F";e.mu.speed="mph";e.mu.pressure="inHg"}};e.switchShortForecast=function(){e.options.forecastDays=e.options.forecastDays==5?e.weather.forecast.length:5};e.setForecastDays=function(t){e.options.forecastDays=t};e.toggleForecast=function(){e.options.showForecast=!e.options.showForecast};var p=function(){if(e.units=="us"){e.switchMu()}if(!e.location&&!e.latitude&&!e.longitude){c()}else if(e.latitude||e.longitude){e.latitude=e.latitude||"0";e.longitude=e.longitude||"0";l(e.latitude,e.longitude,e.location)}else if(e.location&&!e.latitude&&!e.longitude){h(e.location)}};p()}]}}])})()